%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 0 - Projeto de filtro média móvel%% %%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 1 - Preparação do código %% %% Boas práticas: limpeza de variáveis; variáveis globais%% Constantes; carregar bibliotecas;...%%%%% Limpezaclc;          % limpa visual da tela de comandosclose all;    % limpa as figurasclear all;    % limpa as variáveis%%% Pacote de controlepkg load control         %%% Polos e zeros pkg load signal          %%% --> Bilinear%%% ConstantesN   = 10;%%% Equação temporal da média móvelHk = @(xk,xka,xk2a) (xk+xka+xk2a)/3;%%% Equação em frequência da média móvel --> ZNf = 17;Nz = [ones(1,Nf)]*(1/Nf);Dz = [1 zeros(1,Nf-1)];% Polos e zeroszz = roots(Nz);       % zerospz = roots(Dz);       % pólos%%% Resposta impulsiva do filtrofigure(1)impz(Nz,Dz,N); grid%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);%%% Conclusão: o filtro tem resposta impulsiva finita ! FIR%%% Resposta em frequência do filtrofigure(2)freqz(Nz,Dz)%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);%%% Resposta em polos e zerosFPB = tf(Nz,Dz,1)figure(3)pzmap(FPB); %%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);%%% Está correto !!!%%% Determinação do ganho em função da frequênciaHw = @(w,T) (1/3).*exp(-j*w*T).*(1+2*cos(w*T));%%% Supondo uma taxa de amostragemd e 1Hz => T = 1sT    = 1;             % taxa de amostragemfs   = 1/T;           % frequência de amostragemfmax = fs/2;          % frequência máximaf    = [0:0.01:fmax];    % faixa de frequência de análisew    = 2*pi*f;        % frequência angularGanho_FPB = Hw(w,T);  % ganho do filtro na faixa de investigação%%% Visualizar o gráficofigure(4)subplot(2,1,1)plot(w,20*log10(abs(Ganho_FPB)));xlabel('Frequencia');ylabel('Magnitude');title('Modulo do ganho do filtro');grid;%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);subplot(2,1,2)plot(w,angle(Ganho_FPB)*180/pi);xlabel('Frequencia');ylabel('Magnitude');title('Fase do ganho do filtro');grid;%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2 - Sinal: calibração e sinal real%%%% trabalhar com um sinal amostrado%% %% trabalhar com um sinal real - gaita - hamônica [gk,fs] = audioread ('gaita.wav');      % transformei um arquivo .wav em um vetor g(k)  %%% Determinando a taxa de amostragem - T  T = 1/fs;  %%% Aplicar um filtro de média móvel no sinal gk  yk = filter(Nz,Dz,gk);  %%% Visualizando no domínio do tempo  figure(5)subplot(2,1,1)plot(gk);xlabel('Frequencia');ylabel('Magnitude');title('Modulo do ganho do filtro');grid;%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);subplot(2,1,2)plot(yk);xlabel('Frequencia');ylabel('Magnitude');title('Fase do ganho do filtro');grid;%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2); %%% Visualizando no domínio da frequência  [yrs, H] = resample (gk, 1, 11); yks = filter(Nz,Dz,yrs);   Gw = fftshift(abs(fft(yrs))); Yw = fftshift(abs(fft(yks)));  Np = length(Gw);  f1  = linspace(-fs/2,fs/2,Np);   Ganho_FPB = Hw(2*pi*f,T);  % ganho do filtro na faixa de investigação  figure(6)subplot(2,1,1)plot(Gw/(max(Gw)));hold;plot(abs(Ganho_FPB));xlabel('Frequencia');ylabel('Magnitude');title('Modulo do ganho do filtro');grid;%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);subplot(2,1,2)plot(Yw);xlabel('Frequencia');ylabel('Magnitude');title('Fase do ganho do filtro');grid;%%% Aprimora a aparência do gráficoset(findall(gcf,'Type','line'),'LineWidth',3);set(gca,'FontSize',14,'LineWidth',2);  